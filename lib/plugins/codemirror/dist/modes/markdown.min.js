(function(a){if(typeof exports=="object"&&typeof module=="object")a(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../xml/xml","../meta"],a);else a(CodeMirror)})(function(a){"use strict";a.defineMode("markdown",function(b,c){var d=a.modes.hasOwnProperty("xml");var e=a.getMode(b,d?{name:"xml",htmlMode:true}:"text/plain");function f(c){if(a.findModeByName){var d=a.findModeByName(c);if(d)c=d.mime||d.mimes[0]}var e=a.getMode(b,c);return e.name=="null"?null:e}if(c.highlightFormatting===undefined)c.highlightFormatting=false;if(c.maxBlockquoteDepth===undefined)c.maxBlockquoteDepth=0;if(c.underscoresBreakWords===undefined)c.underscoresBreakWords=true;if(c.taskLists===undefined)c.taskLists=false;if(c.strikethrough===undefined)c.strikethrough=false;if(c.tokenTypeOverrides===undefined)c.tokenTypeOverrides={};var g=0;var h={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"tag",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var i in h){if(h.hasOwnProperty(i)&&c.tokenTypeOverrides[i]){h[i]=c.tokenTypeOverrides[i]}}var j=/^([*\-_])(?:\s*\1){2,}\s*$/,k=/^[*\-+]\s+/,l=/^[0-9]+([.)])\s+/,m=/^\[(x| )\](?=\s)/,n=c.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,o=/^ *(?:\={1,}|-{1,})\s*$/,p=/^[^#!\[\]*_\\<>` "'(~]+/,q=new RegExp("^("+(c.fencedCodeBlocks===true?"~~~+|```+":c.fencedCodeBlocks)+")[ \\t]*([\\w+#]*)");function r(a,b,c){b.f=b.inline=c;return c(a,b)}function s(a,b,c){b.f=b.block=c;return c(a,b)}function t(a){return!a||!/\S/.test(a.string)}function u(a){a.linkTitle=false;a.em=false;a.strong=false;a.strikethrough=false;a.quote=0;a.indentedCode=false;if(!d&&a.f==w){a.f=B;a.block=v}a.trailingSpace=0;a.trailingSpaceNewLine=false;a.prevLine=a.thisLine;a.thisLine=null;return null}function v(a,b){var d=a.sol();var e=b.list!==false,g=b.indentedCode;b.indentedCode=false;if(e){if(b.indentationDiff>=0){if(b.indentationDiff<4){b.indentation-=b.indentationDiff}b.list=null}else if(b.indentation>0){b.list=null;b.listDepth=Math.floor(b.indentation/4)}else{b.list=false;b.listDepth=0}}var i=null;if(b.indentationDiff>=4){a.skipToEnd();if(g||t(b.prevLine)){b.indentation-=4;b.indentedCode=true;return h.code}else{return null}}else if(a.eatSpace()){return null}else if((i=a.match(n))&&i[1].length<=6){b.header=i[1].length;if(c.highlightFormatting)b.formatting="header";b.f=b.inline;return z(b)}else if(!t(b.prevLine)&&!b.quote&&!e&&!g&&(i=a.match(o))){b.header=i[0].charAt(0)=="="?1:2;if(c.highlightFormatting)b.formatting="header";b.f=b.inline;return z(b)}else if(a.eat(">")){b.quote=d?1:b.quote+1;if(c.highlightFormatting)b.formatting="quote";a.eatSpace();return z(b)}else if(a.peek()==="["){return r(a,b,F)}else if(a.match(j,true)){b.hr=true;return h.hr}else if((t(b.prevLine)||e)&&(a.match(k,false)||a.match(l,false))){var p=null;if(a.match(k,true)){p="ul"}else{a.match(l,true);p="ol"}b.indentation=a.column()+a.current().length;b.list=true;b.listDepth++;if(c.taskLists&&a.match(m,false)){b.taskList=true}b.f=b.inline;if(c.highlightFormatting)b.formatting=["list","list-"+p];return z(b)}else if(c.fencedCodeBlocks&&(i=a.match(q,true))){b.fencedChars=i[1];b.localMode=f(i[2]);if(b.localMode)b.localState=b.localMode.startState();b.f=b.block=x;if(c.highlightFormatting)b.formatting="code-block";b.code=true;return z(b)}return r(a,b,b.inline)}function w(a,b){var c=e.token(a,b.htmlState);if(d&&b.htmlState.tagStart===null&&(!b.htmlState.context&&b.htmlState.tokenize.isInText)||b.md_inside&&a.current().indexOf(">")>-1){b.f=B;b.block=v;b.htmlState=null}return c}function x(a,b){if(a.sol()&&b.fencedChars&&a.match(b.fencedChars,false)){b.localMode=b.localState=null;b.f=b.block=y;return null}else if(b.localMode){return b.localMode.token(a,b.localState)}else{a.skipToEnd();return h.code}}function y(a,b){a.match(b.fencedChars);b.block=v;b.f=B;b.fencedChars=null;if(c.highlightFormatting)b.formatting="code-block";b.code=true;var d=z(b);b.code=false;return d}function z(a){var b=[];if(a.formatting){b.push(h.formatting);if(typeof a.formatting==="string")a.formatting=[a.formatting];for(var d=0;d<a.formatting.length;d++){b.push(h.formatting+"-"+a.formatting[d]);if(a.formatting[d]==="header"){b.push(h.formatting+"-"+a.formatting[d]+"-"+a.header)}if(a.formatting[d]==="quote"){if(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote){b.push(h.formatting+"-"+a.formatting[d]+"-"+a.quote)}else{b.push("error")}}}}if(a.taskOpen){b.push("meta");return b.length?b.join(" "):null}if(a.taskClosed){b.push("property");return b.length?b.join(" "):null}if(a.linkHref){b.push(h.linkHref,"url")}else{if(a.strong){b.push(h.strong)}if(a.em){b.push(h.em)}if(a.strikethrough){b.push(h.strikethrough)}if(a.linkText){b.push(h.linkText)}if(a.code){b.push(h.code)}}if(a.header){b.push(h.header,h.header+"-"+a.header)}if(a.quote){b.push(h.quote);if(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote){b.push(h.quote+"-"+a.quote)}else{b.push(h.quote+"-"+c.maxBlockquoteDepth)}}if(a.list!==false){var e=(a.listDepth-1)%3;if(!e){b.push(h.list1)}else if(e===1){b.push(h.list2)}else{b.push(h.list3)}}if(a.trailingSpaceNewLine){b.push("trailing-space-new-line")}else if(a.trailingSpace){b.push("trailing-space-"+(a.trailingSpace%2?"a":"b"))}return b.length?b.join(" "):null}function A(a,b){if(a.match(p,true)){return z(b)}return undefined}function B(b,d){var f=d.text(b,d);if(typeof f!=="undefined")return f;if(d.list){d.list=null;return z(d)}if(d.taskList){var i=b.match(m,true)[1]!=="x";if(i)d.taskOpen=true;else d.taskClosed=true;if(c.highlightFormatting)d.formatting="task";d.taskList=false;return z(d)}d.taskOpen=false;d.taskClosed=false;if(d.header&&b.match(/^#+$/,true)){if(c.highlightFormatting)d.formatting="header";return z(d)}var j=b.sol();var k=b.next();if(k==="\\"){b.next();if(c.highlightFormatting){var l=z(d);var n=h.formatting+"-escape";return l?l+" "+n:n}}if(d.linkTitle){d.linkTitle=false;var o=k;if(k==="("){o=")"}o=(o+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var p="^\\s*(?:[^"+o+"\\\\]+|\\\\\\\\|\\\\.)"+o;if(b.match(new RegExp(p),true)){return h.linkHref}}if(k==="`"){var q=d.formatting;if(c.highlightFormatting)d.formatting="code";var r=z(d);var t=b.pos;b.eatWhile("`");var u=1+b.pos-t;if(!d.code){g=u;d.code=true;return z(d)}else{if(u===g){d.code=false;return r}d.formatting=q;return z(d)}}else if(d.code){return z(d)}if(k==="!"&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){b.match(/\[[^\]]*\]/);d.inline=d.f=D;return h.image}if(k==="["&&b.match(/.*\](\(.*\)| ?\[.*\])/,false)){d.linkText=true;if(c.highlightFormatting)d.formatting="link";return z(d)}if(k==="]"&&d.linkText&&b.match(/\(.*\)| ?\[.*\]/,false)){if(c.highlightFormatting)d.formatting="link";var l=z(d);d.linkText=false;d.inline=d.f=D;return l}if(k==="<"&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){d.f=d.inline=C;if(c.highlightFormatting)d.formatting="link";var l=z(d);if(l){l+=" "}else{l=""}return l+h.linkInline}if(k==="<"&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){d.f=d.inline=C;if(c.highlightFormatting)d.formatting="link";var l=z(d);if(l){l+=" "}else{l=""}return l+h.linkEmail}if(k==="<"&&b.match(/^(!--|\w)/,false)){var v=b.string.indexOf(">",b.pos);if(v!=-1){var x=b.string.substring(b.start,v);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(x))d.md_inside=true}b.backUp(1);d.htmlState=a.startState(e);return s(b,d,w)}if(k==="<"&&b.match(/^\/\w*?>/)){d.md_inside=false;return"tag"}var y=false;if(!c.underscoresBreakWords){if(k==="_"&&b.peek()!=="_"&&b.match(/(\w)/,false)){var A=b.pos-2;if(A>=0){var B=b.string.charAt(A);if(B!=="_"&&B.match(/(\w)/,false)){y=true}}}}if(k==="*"||k==="_"&&!y){if(j&&b.peek()===" "){}else if(d.strong===k&&b.eat(k)){if(c.highlightFormatting)d.formatting="strong";var r=z(d);d.strong=false;return r}else if(!d.strong&&b.eat(k)){d.strong=k;if(c.highlightFormatting)d.formatting="strong";return z(d)}else if(d.em===k){if(c.highlightFormatting)d.formatting="em";var r=z(d);d.em=false;return r}else if(!d.em){d.em=k;if(c.highlightFormatting)d.formatting="em";return z(d)}}else if(k===" "){if(b.eat("*")||b.eat("_")){if(b.peek()===" "){return z(d)}else{b.backUp(1)}}}if(c.strikethrough){if(k==="~"&&b.eatWhile(k)){if(d.strikethrough){if(c.highlightFormatting)d.formatting="strikethrough";var r=z(d);d.strikethrough=false;return r}else if(b.match(/^[^\s]/,false)){d.strikethrough=true;if(c.highlightFormatting)d.formatting="strikethrough";return z(d)}}else if(k===" "){if(b.match(/^~~/,true)){if(b.peek()===" "){return z(d)}else{b.backUp(2)}}}}if(k===" "){if(b.match(/ +$/,false)){d.trailingSpace++}else if(d.trailingSpace){d.trailingSpaceNewLine=true}}return z(d)}function C(a,b){var d=a.next();if(d===">"){b.f=b.inline=B;if(c.highlightFormatting)b.formatting="link";var e=z(b);if(e){e+=" "}else{e=""}return e+h.linkInline}a.match(/^[^>]+/,true);return h.linkInline}function D(a,b){if(a.eatSpace()){return null}var d=a.next();if(d==="("||d==="["){b.f=b.inline=E(d==="("?")":"]");if(c.highlightFormatting)b.formatting="link-string";b.linkHref=true;return z(b)}return"error"}function E(a){return function(b,d){var e=b.next();if(e===a){d.f=d.inline=B;if(c.highlightFormatting)d.formatting="link-string";var f=z(d);d.linkHref=false;return f}if(b.match(J(a),true)){b.backUp(1)}d.linkHref=true;return z(d)}}function F(a,b){if(a.match(/^[^\]]*\]:/,false)){b.f=G;a.next();if(c.highlightFormatting)b.formatting="link";b.linkText=true;return z(b)}return r(a,b,B)}function G(a,b){if(a.match(/^\]:/,true)){b.f=b.inline=H;if(c.highlightFormatting)b.formatting="link";var d=z(b);b.linkText=false;return d}a.match(/^[^\]]+/,true);return h.linkText}function H(a,b){if(a.eatSpace()){return null}a.match(/^[^\s]+/,true);if(a.peek()===undefined){b.linkTitle=true}else{a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}b.f=b.inline=B;return h.linkHref+" url"}var I=[];function J(a){if(!I[a]){a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");I[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")")}return I[a]}var K={startState:function(){return{f:v,prevLine:null,thisLine:null,block:v,htmlState:null,indentation:0,inline:B,text:A,formatting:false,linkText:false,linkHref:false,linkTitle:false,em:false,strong:false,header:0,hr:false,taskList:false,list:false,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false,fencedChars:null}},copyState:function(b){return{f:b.f,prevLine:b.prevLine,thisLine:b.this,block:b.block,htmlState:b.htmlState&&a.copyState(e,b.htmlState),indentation:b.indentation,localMode:b.localMode,localState:b.localMode?a.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,formatting:false,linkTitle:b.linkTitle,code:b.code,em:b.em,strong:b.strong,strikethrough:b.strikethrough,header:b.header,hr:b.hr,taskList:b.taskList,list:b.list,listDepth:b.listDepth,quote:b.quote,indentedCode:b.indentedCode,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside,fencedChars:b.fencedChars}},token:function(a,b){b.formatting=false;if(a!=b.thisLine){var c=b.header||b.hr;b.header=0;b.hr=false;if(a.match(/^\s*$/,true)||c){u(b);if(!c)return null;b.prevLine=null}b.prevLine=b.thisLine;b.thisLine=a;b.taskList=false;b.trailingSpace=0;b.trailingSpaceNewLine=false;b.f=b.block;var d=a.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;var e=Math.floor((d-b.indentation)/4)*4;if(e>4)e=4;var f=b.indentation+e;b.indentationDiff=f-b.indentation;b.indentation=f;if(d>0)return null}return b.f(a,b)},innerMode:function(a){if(a.block==w)return{state:a.htmlState,mode:e};if(a.localState)return{state:a.localState,mode:a.localMode};return{state:a,mode:K}},blankLine:u,getType:z,fold:"markdown"};return K},"xml");a.defineMIME("text/x-markdown","markdown")});
//# sourceMappingURL=markdown.min.js.map